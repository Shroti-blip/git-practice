<script>
const emailInput = document.getElementById("email");
const usernameInput = document.getElementById("username");
const suggestionsBox = document.getElementById("usernameSuggestions");

emailInput.addEventListener("blur", async () => {
    const email = emailInput.value.trim();
    if (!email) return;

    const base = email.split("@")[0].replace(/[^a-zA-Z0-9]/g, "").toLowerCase();

    // Generate 3â€“4 variations
    const suggestions = [
        base,
        base + Math.floor(Math.random() * 100),
        base + "_" + Math.floor(Math.random() * 10),
        base + new Date().getFullYear().toString().slice(-2)
    ];

    // Check each one with backend
    const available = [];
    for (const suggestion of suggestions) {
        const res = await fetch(`/check-username?username=${suggestion}`);
        const data = await res.json();
        if (!data.exists) available.push(suggestion);
    }

    // Display available usernames
    if (available.length > 0) {
        suggestionsBox.innerHTML = available.map(u => 
            `<div class="suggestion-item p-1 rounded mb-1" style="cursor:pointer;">${u}</div>`
        ).join("");
        suggestionsBox.classList.remove("d-none");

        // Add click event to fill username field
        document.querySelectorAll(".suggestion-item").forEach(item => {
            item.addEventListener("click", () => {
                usernameInput.value = item.textContent;
                suggestionsBox.classList.add("d-none");
            });
        });
    } else {
        suggestionsBox.innerHTML = `<div class="text-muted">No suggestions available</div>`;
        suggestionsBox.classList.remove("d-none");
    }
});
</script>
